<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BMessage ‚Äî –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –≥—Ä—É–ø–ø–µ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="auth-bg">
        <div class="card" id="joinCard">
            <h2>
                <svg viewBox="0 0 24 24" width="32" height="32" style="vertical-align: middle;">
                    <path fill="#667eea" d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2z"/>
                </svg>
                BMessage
            </h2>
            <div id="joinContent">
                <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const inviteLink = urlParams.get('link');
        
        async function joinGroup() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                // –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≤—Ö–æ–¥
                localStorage.setItem('pendingInvite', inviteLink);
                window.location = 'auth.html';
                return;
            }

            try {
                const res = await fetch(`/groups/join/${inviteLink}`, {
                    method: 'POST',
                    headers: { 'Authorization': token }
                });

                if (res.ok) {
                    const group = await res.json();
                    document.getElementById('joinContent').innerHTML = `
                        <h3>‚úÖ –í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å!</h3>
                        <p>–ì—Ä—É–ø–ø–∞: ${group.name}</p>
                        <button onclick="window.location='chats.html'" style="width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 12px; margin-top: 20px;">
                            –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç—ã
                        </button>
                    `;
                } else {
                    document.getElementById('joinContent').innerHTML = `
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–µ</p>
                        <button onclick="window.location='chats.html'" style="width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 12px; margin-top: 20px;">
                            –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç—ã
                        </button>
                    `;
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                document.getElementById('joinContent').innerHTML = `
                    <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                    <p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–µ</p>
                    <button onclick="window.location='chats.html'" style="width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 12px; margin-top: 20px;">
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç—ã
                    </button>
                `;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (localStorage.getItem('token')) {
            joinGroup();
        } else {
            document.getElementById('joinContent').innerHTML = `
                <h3>üîó –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É</h3>
                <p>–ß—Ç–æ–±—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</p>
                <button onclick="window.location='auth.html'" style="width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 12px; margin-top: 20px;">
                    –í–æ–π—Ç–∏
                </button>
            `;
        }
    </script>
</body>
</html>
